<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Memory Demo</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="/static/toggle.css">
    <script defer src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js"></script>
</head>

<body>
    <script>
        (function () {
            const applyTheme = (theme) => {
                if (theme === 'dark') document.documentElement.classList.add('dark-mode');
                else document.documentElement.classList.remove('dark-mode');
            };
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (savedTheme) applyTheme(savedTheme);
            else if (prefersDark) applyTheme('dark');
        })();
    </script>


    <div class="header-bar">
        <button id="theme-toggle" class="navbar-icon" title="Toggle dark/light mode">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="icon icon-moon">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="icon icon-sun">
                <circle cx="12" cy="12" r="5"></circle>
                <line x1="12" y1="1" x2="12" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="23"></line>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                <line x1="1" y1="12" x2="3" y2="12"></line>
                <line x1="21" y1="12" x2="23" y2="12"></line>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
        </button>
        <button id="info-toggle" class="navbar-icon" title="Info">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="icon icon-info">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="16" x2="12" y2="12"></line>
                <line x1="12" y1="8" x2="12.01" y2="8"></line>
            </svg>
        </button>
        <button id="settings-toggle" class="navbar-icon" title="Settings">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="icon icon-settings">
                <circle cx="12" cy="12" r="3"></circle>
                <path
                    d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                </path>
            </svg>
        </button>
    </div>

    <dialog id="settings-modal" class="settings-modal">
        <form method="dialog" class="settings-form">
            <button id="close-settings" type="submit" class="navbar-icon modal-close-button" title="Close">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="icon icon-close">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            <h2>Settings</h2>
            <div id="settings-container">
                <!-- Settings will be dynamically added here -->
            </div>
        </form>
    </dialog>
    <dialog id="info-modal" class="settings-modal">
        <form method="dialog" class="settings-form">
            <button id="close-info" type="submit" class="navbar-icon modal-close-button" title="Close">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="icon icon-close">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            <h2>About This Demo</h2>
            <p>This is a demo of the Dynamic Memory Agent, a system that uses a language model together 
                with a dynamic, context-aware graph memory to answer questions.</p>
            <p>The demo is set up to contain knowledge about a specific topic, for which it can answer 
                questions using its memory to provide contextually relevant information.</p>
            <p>The system uses an open source language model that can run on consumer hardware, while using the memory
                to enhance its capabilities in order to rival much larger and more resource-intensive models.</p>
            
            <h3>Configuration</h3>
            <ul>
                <li>Language Model: Qwen3-8B-Q4_K_M</li>
                <li>Database: Neo4j Graph Database</li>
                <li>Current Memory Topic: Solar System</li>
            </ul>
            <h3>System</h3>
            <ul>
                <li>GPU: NVIDIA RTX 3090 (24GB)</li>
                <li>CPU: Intel Core i7 13700K</li>
                <li>RAM: 64GB DDR4</li>
            </ul>
        </form>
    </dialog>
    <script src="/static/settings.js"></script>

    <div class="chat-container">

        <div id="multi-message-list">
            <div class="message-list-container" id="message-list-container-2">
                <span id="model-label-2" class="model-label">Model 2</span>
                <div id="message-list-2" class="message-list"></div></div>
            <div class="message-list-container">
                <span id="model-label-1" class="model-label">DynMem</span>
                <div id="message-list" class="message-list"></div></div>
            <div class="message-list-container" id="message-list-container-3">
                <span id="model-label-3" class="model-label">Model 3</span>
                <div id="message-list-3" class="message-list"></div></div>
        </div>

        <form id="chat-form" class="chat-form">
            <textarea id="message-input" placeholder="Type your message..." autocomplete="off" required></textarea>
            <div class="input-container">
                <button id="send-button" type="submit">Send</button>
            </div>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/showdown@2.1.0/dist/showdown.min.js"></script>
    <script src="/static/index.js"></script>
    <script>
        // add initial info message
        window.addEventListener('load', () => {
            addMessage('info', 'response', 'Welcome to the Dynamic Memory Demo!');
            addMessage('info', 'response', 'Ask me about the Solar System!');
        });

        const messageInput_el = document.getElementById('message-input');
        const sendButton_el = document.getElementById('send-button');

        messageInput_el.addEventListener('keydown', function (event) {
            // Check if the key pressed is 'Enter' and the 'Shift' key is NOT held down
            if (event.key === 'Enter' && !event.shiftKey) {
                // Prevent the default action (which is to insert a new line)
                event.preventDefault();

                // Programmatically click the send button to submit the form
                sendButton_el.click();
            }
        });
    </script>
</body>

</html>