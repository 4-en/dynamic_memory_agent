services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
      # target is set by overlays
    container_name: ${COMPOSE_PROJECT_NAME:-myproject}_app
    depends_on:
      - neo4j
    environment:
      NEO4J_URI: bolt://neo4j:7687
      NEO4J_USER: ${NEO4J_USER:-neo4j}
      NEO4J_PASSWORD: ${NEO4J_PASSWORD:-testtest}
    working_dir: /app
    command: "python3 -m dma"
    ports:
      - "3000:3000"
    networks:
      - backend

  neo4j:
    image: neo4j:5
    container_name: ${COMPOSE_PROJECT_NAME:-myproject}_neo4j
    environment:
      NEO4J_AUTH: ${NEO4J_USER:-neo4j}/${NEO4J_PASSWORD:-testtest}
      NEO4J_server_memory_heap_initial__size: 512m
      NEO4J_server_memory_heap_max__size: 1g
      NEO4J_server_default__listen__address: 0.0.0.0
    volumes:
      - neo4j-data:/data
      - neo4j-logs:/logs
      - neo4j-plugins:/plugins
    ports:
      - "7474:7474"
      - "7687:7687"
    networks:
      - backend

networks:
  backend:

volumes:
  neo4j-data:
  neo4j-logs:
  neo4j-plugins:
