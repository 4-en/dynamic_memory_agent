version: "3.9"

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: ${COMPOSE_PROJECT_NAME:-myproject}_app
    depends_on:
      - neo4j
    environment:
      # Example: point your app to Neo4j
      NEO4J_URI: bolt://neo4j:7687
      NEO4J_USER: ${NEO4J_USER:-neo4j}
      NEO4J_PASSWORD: ${NEO4J_PASSWORD:-test}
      # Add other app env vars here...
    volumes:
      - .:/app
    working_dir: /app
    command: sh -lc "npm run dev || python app.py || sleep infinity"
    ports:
      - "3000:3000"   # change/remove if your app exposes something
    networks:
      - backend

  neo4j:
    image: neo4j:5
    container_name: ${COMPOSE_PROJECT_NAME:-myproject}_neo4j
    environment:
      NEO4J_AUTH: ${NEO4J_USER:-neo4j}/${NEO4J_PASSWORD:-test}
      NEO4J_server_memory_heap_initial__size: 512m
      NEO4J_server_memory_heap_max__size: 1g
      NEO4J_server_default__listen__address: 0.0.0.0
    volumes:
      - neo4j-data:/data
      - neo4j-logs:/logs
      - neo4j-plugins:/plugins
    ports:
      - "7474:7474"   # HTTP (Browser)
      - "7687:7687"   # Bolt
    networks:
      - backend

networks:
  backend:

volumes:
  neo4j-data:
  neo4j-logs:
  neo4j-plugins:
